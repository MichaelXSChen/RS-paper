% Remember to use the lgrind style

\Head{}
\File{leader.cpp}{2016}{5}{1}{18:18}{555}
\L{\LB{\V{viewstamp\_t}_\V{idx};}}
\index{invoke\_consensus\_req}\Proc{invoke\_consensus\_req}\L{\LB{\K{void}_\V{invoke\_consensus\_req}(\V{node}_*\V{cur},_}}
\L{\LB{}\Tab{4}{\V{call}_\V{type},_\V{data},_\V{data\_size})_\{}}
\L{\LB{}\Tab{2}{\V{vs};}}
\L{\LB{}}
\L{\LB{}\Tab{2}{\C{}//_Local_preparation.\CE{}}}
\L{\LB{}\Tab{2}{\V{spin\_lock}();}}
\L{\LB{}\Tab{2}{\V{vs}_=_\V{idx}++;}}
\L{\LB{}\Tab{2}{\V{spin\_unlock}();}}
\L{\LB{}\Tab{2}{\V{call\_entry}_*\V{entry}_=_\V{build\_entry}(\V{cur},\V{vs},\V{data},\V{data\_size});}}
\L{\LB{}\Tab{2}{\V{mem\_write}(\V{cur\_log\_offset},_\V{entry});_}}
\L{\LB{}\Tab{2}{\V{store\_entry}(\V{entry});}}
\L{\LB{}}
\L{\LB{}\Tab{2}{\C{}//_RDMA_write.\CE{}}}
\L{\LB{}\Tab{2}{\K{for}_(\V{i}_=_\N{0};_\V{i}_\<_\V{group\_size};_\V{i}++)_\{}}
\L{\LB{}\Tab{4}{\V{RDMA\_write}(\V{i},_\V{remote\_log\_offset}[\V{i}],_\V{entry});}}
\L{\LB{}\Tab{2}{\}}}
\L{\LB{}\Tab{2}{}}
\L{\LB{}\Tab{2}{\C{}//_Wait_for_quorum.\CE{}}}
\L{\LB{\V{recheck:}}}
\L{\LB{}\Tab{2}{\K{for}_(\V{i}_=_\N{0};_\V{i}_\<_;_\V{i}++)_\{}}
\L{\LB{}\Tab{4}{\V{bitmap}_+=_\V{ack}[\V{i}].\V{reply};}}
\L{\LB{}\Tab{2}{\}}}
\L{\LB{}\Tab{2}{\K{if}_(\V{reach\_quorum}())_\{}}
\L{\LB{}\Tab{4}{\V{process\_req}();}}
\L{\LB{}\Tab{2}{\}_\K{else}}}
\L{\LB{}\Tab{4}{\K{goto}_\V{recheck};}}
\L{\LB{\}}}
